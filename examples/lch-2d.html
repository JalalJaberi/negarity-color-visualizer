<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCh 2D Visualization - Negarity Color Visualizer</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .example-section {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .visualizer-container {
            width: 100%;
            height: 600px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
        }
        .controls {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .controls h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 8px;
        }
        .control-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .control-group label {
            display: inline-block;
            min-width: 120px;
            font-weight: 500;
            color: #555;
        }
        .control-group input[type="number"] {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 80px;
        }
        .controls button {
            padding: 10px 20px;
            margin: 5px;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .controls button:hover {
            background: #005a87;
        }
        .info {
            background: #e7f3ff;
            border-left: 4px solid #007cba;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info p {
            margin: 5px 0;
            color: #555;
        }
        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .preset-buttons button {
            padding: 8px 16px;
            font-size: 13px;
        }
        .range-value {
            display: inline-block;
            min-width: 40px;
            text-align: center;
            font-weight: 500;
            color: #007cba;
        }
        .control-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .control-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #444;
            font-size: 16px;
        }
        .sub-control-group {
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid #e0e0e0;
            margin-top: 10px;
        }
        .visualizer-with-channels {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .visualizer-with-channels .visualizer-container {
            flex: 1 1 min(400px, 100%);
            min-width: 0;
        }
        .ccv-section {
            flex: 0 1 320px;
            min-width: 0;
        }
        .ccv-container {
            min-height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>LCh 2D Visualization</h1>
        <p class="subtitle">CIE L*C*h* Color Space - Chromaticity Diagram</p>
        
        <div class="info">
            <p><strong>What is this?</strong></p>
            <p>This visualization shows the CIE L*C*h* color space using the xy chromaticity diagram. LCh colors are converted to Lab, then to XYZ, then to xy coordinates for display. This shows where LCh colors fall within the visible color spectrum.</p>
        </div>

        <div class="example-section">
            <div class="visualizer-with-channels">
                <div id="lch-visualizer" class="visualizer-container"></div>
                <div class="ccv-section">
                    <h4 style="margin: 0 0 10px 0;">Channel sliders</h4>
                    <div id="ccv-container" class="ccv-container"></div>
                </div>
            </div>
            
            <div class="controls">
                <h3>Color Point Controls</h3>
                <div class="control-group">
                    <label>L* (Lightness):</label>
                    <input type="number" id="l-value" min="0" max="100" value="50">
                    <label>C* (Chroma):</label>
                    <input type="number" id="c-value" min="0" max="150" value="0">
                    <label>h* (Hue):</label>
                    <input type="number" id="h-value" min="0" max="360" value="0">
                    <button onclick="updateFromInputs()">Update Point</button>
                </div>

                <h3>Preset Colors</h3>
                <div class="preset-buttons">
                    <button onclick="setColorFromRgb(128, 128, 128, 'Neutral Gray')">Neutral Gray</button>
                    <button onclick="setColorFromRgb(255, 0, 0, 'Red')">Red</button>
                    <button onclick="setColorFromRgb(0, 255, 0, 'Green')">Green</button>
                    <button onclick="setColorFromRgb(255, 255, 0, 'Yellow')">Yellow</button>
                    <button onclick="setColorFromRgb(0, 0, 255, 'Blue')">Blue</button>
                    <button onclick="setColorFromRgb(255, 255, 255, 'White')">White</button>
                    <button onclick="setColorFromRgb(0, 0, 0, 'Black')">Black</button>
                </div>

                <!-- CIE Background Controls -->
                <div class="control-section">
                    <h4>CIE Background Settings</h4>
                    <div class="control-group">
                        <label>Show Background:</label>
                        <input type="checkbox" id="cie-bg-show" checked onchange="updateCIEBackground()">
                    </div>
                    <div class="control-group">
                        <label>Brightness:</label>
                        <input type="range" id="cie-bg-brightness" min="0" max="1" step="0.01" value="1.0" oninput="updateCIEBackground()">
                        <span class="range-value" id="cie-bg-brightness-value">1.0</span>
                    </div>
                    <div class="control-group">
                        <label>Opacity:</label>
                        <input type="range" id="cie-bg-opacity" min="0" max="1" step="0.01" value="0.85" oninput="updateCIEBackground()">
                        <span class="range-value" id="cie-bg-opacity-value">0.85</span>
                    </div>
                </div>

                <!-- Axes Controls -->
                <div class="control-section">
                    <h4>Axes Settings</h4>
                    <div class="control-group">
                        <label>Show Axes:</label>
                        <input type="checkbox" id="axes-show" checked onchange="updateAxes()">
                    </div>
                    <div class="control-group">
                        <label>Show Lines:</label>
                        <input type="checkbox" id="axes-show-lines" checked onchange="updateAxes()">
                    </div>
                    <div class="control-group">
                        <label>Show Labels:</label>
                        <input type="checkbox" id="axes-show-labels" checked onchange="updateAxes()">
                    </div>
                </div>

                <!-- Marker Controls -->
                <div class="control-section">
                    <h4>Marker Settings</h4>
                    <div class="control-group">
                        <label>Show Marker:</label>
                        <input type="checkbox" id="marker-show" checked onchange="updateMarker()">
                    </div>
                    <div class="control-group">
                        <label>Show Label:</label>
                        <input type="checkbox" id="marker-show-label" checked onchange="updateMarker()">
                    </div>
                    <div class="control-group">
                        <label>Shape:</label>
                        <select id="marker-shape" onchange="updateMarker()">
                            <option value="circle">Circle</option>
                            <option value="square">Square</option>
                            <option value="triangle">Triangle</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Size:</label>
                        <input type="range" id="marker-size" min="5" max="30" step="1" value="10" oninput="updateMarker()">
                        <span class="range-value" id="marker-size-value">10</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="/src/examples/lch-2d-demo.ts"></script>
    <script>
        function updateFromInputs() {
            const l = parseFloat(document.getElementById('l-value').value) || 0;
            const c = parseFloat(document.getElementById('c-value').value) || 0;
            const h = parseFloat(document.getElementById('h-value').value) || 0;
            
            if (window.updatePoint) {
                window.updatePoint(l, c, h, `LCh(${l.toFixed(1)}, ${c.toFixed(1)}, ${h.toFixed(1)}Â°)`);
            }
        }

        function setColor(l, c, h, label) {
            document.getElementById('l-value').value = l;
            document.getElementById('c-value').value = c;
            document.getElementById('h-value').value = h;
            
            if (window.updatePoint) {
                window.updatePoint(l, c, h, label);
            }
        }

        // Convert RGB to LCh and set the color
        function setColorFromRgb(r, g, b, label) {
            // Use the rgbToLab function from the module
            const rgbToLabMap = {
                '255,0,0': [53.2, 80.1, 67.2], // Red -> Lab
                '0,255,0': [87.7, -86.2, 83.2], // Green -> Lab
                '0,0,255': [32.3, 79.2, -107.9], // Blue -> Lab
                '255,255,0': [97.1, -21.6, 94.5], // Yellow -> Lab
                '255,255,255': [100, 0, 0], // White -> Lab
                '0,0,0': [0, 0, 0], // Black -> Lab
                '128,128,128': [53.4, 0, 0], // Neutral Gray -> Lab
            };
            
            const key = `${r},${g},${b}`;
            if (rgbToLabMap[key]) {
                const [l_lab, a, b_lab] = rgbToLabMap[key];
                // Convert Lab to LCh
                const c = Math.sqrt(a * a + b_lab * b_lab);
                let h = (Math.atan2(b_lab, a) * 180) / Math.PI;
                if (h < 0) h += 360;
                setColor(l_lab, c, h, label);
            } else {
                // Fallback: try to convert using the module if available
                if (window.rgbToLab) {
                    const [l_lab, a, b_lab] = window.rgbToLab(r, g, b);
                    const c = Math.sqrt(a * a + b_lab * b_lab);
                    let h = (Math.atan2(b_lab, a) * 180) / Math.PI;
                    if (h < 0) h += 360;
                    setColor(l_lab, c, h, label);
                }
            }
        }

        function updateCIEBackground() {
            const show = document.getElementById('cie-bg-show').checked;
            const brightness = parseFloat(document.getElementById('cie-bg-brightness').value);
            const opacity = parseFloat(document.getElementById('cie-bg-opacity').value);
            
            document.getElementById('cie-bg-brightness-value').textContent = brightness.toFixed(2);
            document.getElementById('cie-bg-opacity-value').textContent = opacity.toFixed(2);
            
            if (window.updateCIEBackgroundFn) {
                window.updateCIEBackgroundFn({
                    show: show,
                    brightness: brightness,
                    opacity: opacity
                });
            }
        }

        function updateAxes() {
            const show = document.getElementById('axes-show').checked;
            const showLines = document.getElementById('axes-show-lines').checked;
            const showLabels = document.getElementById('axes-show-labels').checked;
            
            if (window.updateAxesFn) {
                window.updateAxesFn({
                    show: show,
                    showLines: showLines,
                    showLabels: showLabels
                });
            }
        }

        function updateMarker() {
            const show = document.getElementById('marker-show').checked;
            const showLabel = document.getElementById('marker-show-label').checked;
            const shape = document.getElementById('marker-shape').value;
            const size = parseInt(document.getElementById('marker-size').value);
            
            document.getElementById('marker-size-value').textContent = size;
            
            if (window.updateMarkerFn) {
                window.updateMarkerFn({
                    show: show,
                    showLabel: showLabel,
                    shape: shape,
                    size: size
                });
            }
        }
    </script>
</body>
</html>
